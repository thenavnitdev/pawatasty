<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Validation Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #ff6b35;
            margin-bottom: 30px;
        }
        .test-case {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
            border-left: 4px solid #ff6b35;
        }
        .test-input {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        input {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            padding: 10px 20px;
            background: #ff6b35;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #e55a2b;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üì± Phone Validation Test</h1>
        <p>Test the phone validation logic with different inputs:</p>

        <div class="test-case">
            <strong>Test 1: Normal input (9 digits)</strong>
            <div class="test-input">
                <span>+31</span>
                <input type="tel" id="test1" placeholder="612345678" maxlength="9">
                <button onclick="testPhone('test1')">Test</button>
            </div>
            <div id="result1"></div>
        </div>

        <div class="test-case">
            <strong>Test 2: With leading zero</strong>
            <div class="test-input">
                <span>+31</span>
                <input type="tel" id="test2" placeholder="0612345678">
                <button onclick="testPhone('test2')">Test</button>
            </div>
            <div id="result2"></div>
        </div>

        <div class="test-case">
            <strong>Test 3: User types country code again</strong>
            <div class="test-input">
                <span>+31</span>
                <input type="tel" id="test3" placeholder="31612345678">
                <button onclick="testPhone('test3')">Test</button>
            </div>
            <div id="result3"></div>
        </div>

        <div class="test-case">
            <strong>Test 4: Too long (10 digits)</strong>
            <div class="test-input">
                <span>+31</span>
                <input type="tel" id="test4" placeholder="6123456789">
                <button onclick="testPhone('test4')">Test</button>
            </div>
            <div id="result4"></div>
        </div>
    </div>

    <script>
        // Simulate the actual phone validation logic
        function formatPhoneNumber(dialCode, localNumber) {
            let cleanLocal = localNumber.replace(/[\s\-()]/g, '');
            cleanLocal = cleanLocal.replace(/^0+/, '');
            const cleanLocalDigits = cleanLocal.replace(/\D/g, '');
            let cleanDialCode = dialCode.trim();
            if (!cleanDialCode.startsWith('+')) {
                cleanDialCode = '+' + cleanDialCode.replace(/\D/g, '');
            } else {
                cleanDialCode = '+' + cleanDialCode.substring(1).replace(/\D/g, '');
            }
            return cleanDialCode + cleanLocalDigits;
        }

        function validatePhoneNumber(phoneNumber) {
            const cleaned = phoneNumber.replace(/[\s\-()]/g, '');

            if (!cleaned.startsWith('+')) {
                return { isValid: false, error: 'Phone number must include country code' };
            }

            if (cleaned.length < 8) {
                return { isValid: false, error: 'Phone number is too short' };
            }

            if (cleaned.length > 16) {
                return { isValid: false, error: 'Number is too long' };
            }

            if (cleaned.startsWith('+31')) {
                const digitCount = cleaned.substring(1).length;

                if (digitCount < 10) {
                    return { isValid: false, error: 'Phone number for Netherlands is too short (minimum 10 digits)' };
                }

                if (digitCount > 11) {
                    return { isValid: false, error: 'Number is too long. Enter only your phone number without the country code' };
                }

                return { isValid: true, formatted: cleaned };
            }

            return { isValid: true, formatted: cleaned };
        }

        function simulateInputHandler(input, dialCode) {
            let digits = input.replace(/\D/g, '');

            // Remove leading zeros
            digits = digits.replace(/^0+/, '');

            // Auto-detect duplicate country code
            const countryCodeDigits = dialCode.substring(1);
            if (digits.startsWith(countryCodeDigits)) {
                const withoutDupe = digits.substring(countryCodeDigits.length);
                if (withoutDupe.length >= 8 && withoutDupe.length <= 9) {
                    digits = withoutDupe;
                }
            }

            // Check length
            if (digits.length > 9) {
                return { blocked: true, reason: 'Input blocked: too long (max 9 digits)' };
            }

            return { blocked: false, processed: digits };
        }

        function testPhone(inputId) {
            const input = document.getElementById(inputId);
            const resultDiv = document.getElementById('result' + inputId.slice(-1));
            const userInput = input.value;
            const dialCode = '+31';

            // Step 1: Input handler
            const inputResult = simulateInputHandler(userInput, dialCode);

            if (inputResult.blocked) {
                resultDiv.innerHTML = `<div class="result error">${inputResult.reason}</div>`;
                return;
            }

            // Step 2: Format
            const formatted = formatPhoneNumber(dialCode, inputResult.processed);

            // Step 3: Validate
            const validation = validatePhoneNumber(formatted);

            const totalDigits = formatted.substring(1).length;
            const charCount = formatted.length;

            if (validation.isValid) {
                resultDiv.innerHTML = `
                    <div class="result success">‚úÖ Valid Phone Number</div>
                    <div class="info">
                        Input: ${userInput}<br>
                        Processed: ${inputResult.processed}<br>
                        Final: ${formatted}<br>
                        Format: ${charCount} chars (including +), ${totalDigits} digits after +<br>
                        Expected: 12 chars, 11 digits ‚úì
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="result error">‚ùå ${validation.error}</div>
                    <div class="info">
                        Input: ${userInput}<br>
                        Processed: ${inputResult.processed}<br>
                        Final: ${formatted}<br>
                        Total digits: ${totalDigits}
                    </div>
                `;
            }
        }

        // Auto-run all tests on load
        window.onload = function() {
            setTimeout(() => {
                document.getElementById('test1').value = '612345678';
                testPhone('test1');
            }, 500);

            setTimeout(() => {
                document.getElementById('test2').value = '0612345678';
                testPhone('test2');
            }, 1000);

            setTimeout(() => {
                document.getElementById('test3').value = '31612345678';
                testPhone('test3');
            }, 1500);

            setTimeout(() => {
                document.getElementById('test4').value = '6123456789';
                testPhone('test4');
            }, 2000);
        };
    </script>
</body>
</html>
